<div class="boutiques-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Gestion des Boutiques</h1>
      <p>Contrats de location et suivi des locataires</p>
    </div>
    <button class="btn btn-primary" (click)="openContratModal()">
      <span>ğŸ“</span>
      Nouveau Contrat
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-row">
    <div class="stat-card">
      <span class="stat-icon">ğŸ“‹</span>
      <div class="stat-content">
        <span class="stat-value">{{ getStats().total }}</span>
        <span class="stat-label">Total Contrats</span>
      </div>
    </div>
    <div class="stat-card">
      <span class="stat-icon">âœ…</span>
      <div class="stat-content">
        <span class="stat-value">{{ getStats().actifs }}</span>
        <span class="stat-label">Actifs</span>
      </div>
    </div>
    <div class="stat-card warning">
      <span class="stat-icon">â°</span>
      <div class="stat-content">
        <span class="stat-value">{{ getStats().expirant }}</span>
        <span class="stat-label">Expirent bientÃ´t</span>
      </div>
    </div>
    <div class="stat-card highlight">
      <span class="stat-icon">ğŸ’°</span>
      <div class="stat-content">
        <span class="stat-value">{{ formatMontant(getStats().totalLoyers) }} Ar</span>
        <span class="stat-label">Loyers mensuels</span>
      </div>
    </div>
  </div>

  <!-- Contracts Table -->
  <div class="table-card">
    <div class="card-header">
      <h2>Liste des Contrats</h2>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>Boutique</th>
          <th>Locataire</th>
          <th>Emplacement</th>
          <th>Surface</th>
          <th>Loyer</th>
          <th>PÃ©riode</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (contrat of contrats(); track contrat.id) {
          <tr>
            <td>
              <div class="boutique-cell">
                <span class="boutique-name">{{ contrat.nomEntreprise }}</span>
              </div>
            </td>
            <td>{{ contrat.nomClient }}</td>
            <td>
              <span class="location-badge">
                {{ contrat.etage }}{{ contrat.etage === 1 ? 'er' : 'Ã¨me' }} - {{ contrat.numero }}
              </span>
            </td>
            <td>{{ contrat.surface }} mÂ²</td>
            <td>
              <span class="amount">{{ formatMontant(contrat.loyerMensuel) }} Ar</span>
            </td>
            <td>
              <div class="period">
                <span>{{ formatDate(contrat.dateDebut) }}</span>
                <span class="separator">â†’</span>
                <span>{{ formatDate(contrat.dateFin) }}</span>
              </div>
              @if (getDaysRemaining(contrat.dateFin) <= 90 && getDaysRemaining(contrat.dateFin) > 0) {
                <span class="days-warning">âš ï¸ {{ getDaysRemaining(contrat.dateFin) }} jours restants</span>
              }
            </td>
            <td>
              <span class="status-badge" [class]="getStatutClass(contrat.statut)">
                {{ getStatutLabel(contrat.statut) }}
              </span>
            </td>
            <td>
              <div class="actions">
                <button class="action-btn" title="Voir le contrat" (click)="viewContratPdf(contrat)">
                  ğŸ“„
                </button>
                <button class="action-btn" title="Modifier">
                  âœï¸
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (contrats().length === 0) {
      <div class="empty-state">
        <span>ğŸ“‹</span>
        <p>Aucun contrat enregistrÃ©</p>
        <button class="btn btn-primary" (click)="openContratModal()">
          CrÃ©er un contrat
        </button>
      </div>
    }
  </div>
</div>

<!-- New Contract Modal -->
@if (showContratModal()) {
  <div class="modal-overlay" (click)="closeContratModal()">
    <div class="modal modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Nouveau Contrat de Location</h2>
        <button class="close-btn" (click)="closeContratModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-section">
          <h3>Informations du locataire</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Nom du client</label>
              <input type="text" [(ngModel)]="newContrat.nomClient" placeholder="Nom et prÃ©nom">
            </div>
            <div class="form-group">
              <label>Nom de l'entreprise</label>
              <input type="text" [(ngModel)]="newContrat.nomEntreprise" placeholder="Nom de la boutique">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Emplacement</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Ã‰tage</label>
              <select [(ngModel)]="newContrat.etage">
                <option [ngValue]="1">1er Ã©tage</option>
                <option [ngValue]="2">2Ã¨me Ã©tage</option>
              </select>
            </div>
            <div class="form-group">
              <label>NumÃ©ro du local</label>
              <input type="text" [(ngModel)]="newContrat.numero" placeholder="Ex: A-101">
            </div>
            <div class="form-group">
              <label>Surface (mÂ²)</label>
              <input type="number" [(ngModel)]="newContrat.surface" min="10">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Conditions financiÃ¨res</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Loyer mensuel (Ariary)</label>
              <input type="number" [(ngModel)]="newContrat.loyerMensuel" min="0" step="100000">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>DurÃ©e du contrat</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Date de dÃ©but</label>
              <input type="date" [ngModel]="newContrat.dateDebut | date:'yyyy-MM-dd'" (ngModelChange)="newContrat.dateDebut = $event">
            </div>
            <div class="form-group">
              <label>Date de fin</label>
              <input type="date" [ngModel]="newContrat.dateFin | date:'yyyy-MM-dd'" (ngModelChange)="newContrat.dateFin = $event">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeContratModal()">Annuler</button>
        <button class="btn btn-primary" (click)="saveContrat()">
          <span>ğŸ“„</span>
          GÃ©nÃ©rer le contrat
        </button>
      </div>
    </div>
  </div>
}

<!-- PDF Preview Modal -->
@if (showPdfPreview() && selectedContrat()) {
  <div class="modal-overlay" (click)="closePdfPreview()">
    <div class="modal modal-pdf" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Contrat - {{ selectedContrat()!.nomEntreprise }}</h2>
        <div class="header-actions">
          <button class="btn btn-outline" (click)="downloadPdf()">
            <span>â¬‡ï¸</span>
            TÃ©lÃ©charger
          </button>
          <button class="close-btn" (click)="closePdfPreview()">âœ•</button>
        </div>
      </div>
      <div class="modal-body pdf-body">
        <div class="pdf-preview">
          <pre>{{ generateContratText(selectedContrat()!) }}</pre>
        </div>
      </div>
    </div>
  </div>
}
