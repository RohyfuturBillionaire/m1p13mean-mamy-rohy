<div class="admin-layout" [class.sidebar-collapsed]="sidebarCollapsed()" [class.sidebar-mobile-open]="sidebarMobileOpen()">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <a routerLink="/admin/dashboard" class="logo">
        <span class="logo-icon">TC</span>
        <span class="logo-text">Tana Center</span>
      </a>
      <button class="collapse-btn desktop-toggle" (click)="toggleSidebar()" title="Replier/Déplier">
        <span class="material-icons">{{ sidebarCollapsed() ? 'chevron_right' : 'chevron_left' }}</span>
      </button>
    </div>

    <nav class="sidebar-nav">
      @for (item of menuItems; track item.route) {
        <a
          [routerLink]="item.route"
          routerLinkActive="active"
          class="nav-item"
          [attr.data-tooltip]="item.label"
          (click)="onNavClick()"
        >
          <span class="material-icons">{{ item.icon }}</span>
          <span class="nav-label">{{ item.label }}</span>
        </a>
      }
    </nav>

    <div class="sidebar-footer">
      <a routerLink="/" class="nav-item" data-tooltip="Voir le site" (click)="onNavClick()">
        <span class="material-icons">language</span>
        <span class="nav-label">Voir le site</span>
      </a>
      <button class="logout-btn" (click)="logout()" data-tooltip="Déconnexion">
        <span class="material-icons">logout</span>
        <span class="nav-label">Déconnexion</span>
      </button>
    </div>
  </aside>

  <!-- Mobile Sidebar Backdrop -->
  @if (sidebarMobileOpen()) {
    <div class="sidebar-backdrop" (click)="closeMobileSidebar()"></div>
  }

  <!-- Main Content -->
  <div class="main-wrapper">
    <!-- Topbar -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" (click)="toggleMobileSidebar()" aria-label="Menu">
          <span class="material-icons">menu</span>
        </button>
        <h1 class="page-title">Administration</h1>
      </div>

      <div class="topbar-right">
        <!-- Search -->
        <div class="search-box">
          <span class="material-icons">search</span>
          <input type="text" placeholder="Rechercher...">
        </div>

        <!-- Notifications -->
        <div class="notification-wrapper">
          <button class="icon-btn" (click)="toggleNotifications()" [class.active]="showNotifications()">
            <span class="material-icons">notifications</span>
            @if (unreadCount() > 0) {
              <span class="badge">{{ unreadCount() }}</span>
            }
          </button>

          @if (showNotifications()) {
            <div class="dropdown notification-dropdown">
              <div class="dropdown-header">
                <h3>Notifications</h3>
                <span class="unread-count">{{ unreadCount() }} non lues</span>
              </div>
              <div class="dropdown-body">
                @if (notifications().length === 0) {
                  <div class="empty-notifications">
                    <span class="material-icons">notifications_none</span>
                    <p>Aucune notification</p>
                  </div>
                } @else {
                  @for (notif of notifications(); track notif.id) {
                    <button
                      class="notification-item"
                      [class.unread]="!notif.lu"
                      (click)="markAsRead(notif)"
                    >
                      <span
                        class="notif-icon material-icons"
                        [style.color]="getNotificationColor(notif.type)"
                      >
                        {{ getNotificationIcon(notif.type) }}
                      </span>
                      <div class="notif-content">
                        <span class="notif-title">{{ notif.titre }}</span>
                        <span class="notif-message">{{ notif.message }}</span>
                        <span class="notif-time">{{ formatDate(notif.date) }}</span>
                      </div>
                    </button>
                  }
                }
              </div>
              <div class="dropdown-footer">
                <a routerLink="/admin/notifications" (click)="showNotifications.set(false)">
                  Voir toutes les notifications
                </a>
              </div>
            </div>
          }
        </div>

        <!-- User Menu -->
        <div class="user-wrapper">
          <button class="user-btn" (click)="toggleUserMenu()" [class.active]="showUserMenu()">
            <div class="user-avatar">
              <span class="material-icons">person</span>
            </div>
            <span class="user-name">Admin</span>
            <span class="material-icons arrow">{{ showUserMenu() ? 'expand_less' : 'expand_more' }}</span>
          </button>

          @if (showUserMenu()) {
            <div class="dropdown user-dropdown">
              <a routerLink="/admin/profil" class="dropdown-item" (click)="showUserMenu.set(false)">
                <span class="material-icons">account_circle</span>
                Mon Profil
              </a>
              <a routerLink="/admin/parametres" class="dropdown-item" (click)="showUserMenu.set(false)">
                <span class="material-icons">settings</span>
                Paramètres
              </a>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item logout" (click)="logout()">
                <span class="material-icons">logout</span>
                Déconnexion
              </button>
            </div>
          }
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

<!-- Backdrop for dropdowns -->
@if (showNotifications() || showUserMenu()) {
  <div class="dropdown-backdrop" (click)="closeDropdowns()"></div>
}
