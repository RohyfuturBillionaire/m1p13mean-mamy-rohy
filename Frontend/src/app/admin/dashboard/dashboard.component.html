<div class="dashboard">
  <div class="dashboard-header">
    <div>
      <h1>Tableau de Bord</h1>
      <p>Bienvenue dans l'administration de Tana Center</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline">
        <span class="material-icons">calendar_today</span>
        Février 2024
      </button>
      <button class="btn btn-primary">
        <span class="material-icons">file_download</span>
        Exporter
      </button>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="kpi-grid">
    @for (kpi of kpis(); track kpi.label) {
      <div class="kpi-card" [style.--accent-color]="kpi.color">
        <div class="kpi-icon">
          <span class="material-icons">{{ getKPIIcon(kpi.icon) }}</span>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">{{ kpi.label }}</span>
          <span class="kpi-value">{{ kpi.value }}</span>
          <!-- @if (kpi.change) {
            <span class="kpi-change" [class.positive]="kpi.change > 0" [class.negative]="kpi.change < 0">
              {{ kpi.change > 0 ? '↑' : '↓' }} {{ kpi.change }}%
            </span>
          } -->
        </div>
      </div>
    }
  </div>

  <!-- Charts Row -->
  <div class="charts-row">
    <!-- Revenue Chart -->
    <div class="chart-card large">
      <div class="card-header">
        <h3>Revenus Mensuels</h3>
        <span class="period">2024</span>
      </div>
      <div class="chart-container">
        <div class="bar-chart">
          @for (value of revenueData().data; track $index; let i = $index) {
            <div class="bar-item">
              <div class="bar-wrapper">
                <div
                  class="bar"
                  [style.height.%]="(value / getMaxRevenue()) * 100"
                  [style.background]="chartColors[i % chartColors.length]"
                >
                  <span class="bar-tooltip">{{ formatMontant(value) }} Ar</span>
                </div>
              </div>
              <span class="bar-label">{{ revenueData().labels[i] }}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Loyers par Boutique -->
    <div class="chart-card">
      <div class="card-header">
        <h3>Loyers par Boutique</h3>
        <a routerLink="/admin/loyers" class="link">Voir tout</a>
      </div>
      <div class="chart-container">
        <div class="horizontal-bars">
          @for (value of loyersData().data; track $index; let i = $index) {
            <div class="h-bar-item">
              <div class="h-bar-label">{{ loyersData().labels[i] }}</div>
              <div class="h-bar-wrapper">
                <div
                  class="h-bar"
                  [style.width.%]="(value / getMaxLoyer()) * 100"
                  [style.background]="chartColors[i % chartColors.length]"
                ></div>
                <span class="h-bar-value">{{ formatMontant(value) }} Ar</span>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Second Row -->
  <div class="info-row">
    <!-- Promotions Stats -->
    <div class="info-card">
      <div class="card-header">
        <h3>Statistiques Promotions</h3>
        <a routerLink="/admin/promotions" class="link">Gérer</a>
      </div>
      <div class="donut-chart-container">
        <div class="donut-chart">
          <svg viewBox="0 0 36 36" class="circular-chart">
            @for (value of promotionsStats().data; track $index; let i = $index) {
              <circle
                class="donut-segment"
                [attr.stroke]="promotionColors[i]"
                [attr.stroke-dasharray]="getPromotionPercentage(value) + ' ' + (100 - getPromotionPercentage(value))"
                [attr.stroke-dashoffset]="getDonutOffset(i)"
                cx="18" cy="18" r="15.915"
              />
            }
          </svg>
          <div class="donut-center">
            <span class="donut-value">{{ getTotalPromotions() }}</span>
            <span class="donut-label">Total</span>
          </div>
        </div>
        <div class="donut-legend">
          @for (label of promotionsStats().labels; track $index; let i = $index) {
            <div class="legend-item">
              <span class="legend-dot" [style.background]="promotionColors[i]"></span>
              <span class="legend-label">{{ label }}</span>
              <span class="legend-value">{{ promotionsStats().data[i] }}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Recent Notifications -->
    <div class="info-card">
      <div class="card-header">
        <h3>Notifications Récentes</h3>
        <span class="badge">{{ recentNotifications().length }}</span>
      </div>
      <div class="notifications-list">
        <!-- @for (notif of recentNotifications(); track notif.id) {
          <div class="notif-item" [class]="getNotificationClass(notif.type)">
            <span class="notif-icon"><span class="material-icons">{{ getNotificationIcon(notif.type) }}</span></span>
            <div class="notif-content">
              <span class="notif-title">{{ notif.titre }}</span>
              <span class="notif-message">{{ notif.message }}</span>
            </div>
            <span class="notif-time">{{ formatDate(notif.date) }}</span>
          </div>
        } -->
      </div>
    </div>

    <!-- Alerts -->
    <div class="info-card alerts-card">
      <div class="card-header">
        <h3>Alertes</h3>
        <span class="badge warning">{{ overduePayments().length + pendingPromotions().length }}</span>
      </div>

      <!-- Retards de paiement -->
      @if (overduePayments().length > 0) {
        <div class="alert-section">
          <h4><span class="material-icons" style="vertical-align: middle; font-size: 1.1rem; margin-right: 4px;">warning</span> Retards de Paiement</h4>
          <!-- @for (payment of overduePayments(); track payment.id) {
            <div class="alert-item danger">
              <div class="alert-content">
                <span class="alert-title">{{ payment.boutiqueNom }}</span>
                <span class="alert-desc">{{ formatMontant(payment.montant) }} Ar - {{ payment.mois }} {{ payment.annee }}</span>
              </div>
              <a routerLink="/admin/loyers" class="alert-action">Voir</a>
            </div>
          } -->
        </div>
      }

      <!-- Demandes en attente -->
      @if (pendingPromotions().length > 0) {
        <div class="alert-section">
          <h4><span class="material-icons" style="vertical-align: middle; font-size: 1.1rem; margin-right: 4px;">assignment</span> Demandes en Attente</h4>
          <!-- @for (promo of pendingPromotions(); track promo.id) {
            <div class="alert-item warning">
              <div class="alert-content">
                <span class="alert-title">{{ promo.boutiqueNom }}</span>
                <span class="alert-desc">{{ promo.titre }}</span>
              </div>
              <a routerLink="/admin/promotions" class="alert-action">Traiter</a>
            </div>
          } -->
        </div>
      }

      @if (overduePayments().length === 0 && pendingPromotions().length === 0) {
        <div class="no-alerts">
          <span class="material-icons" style="font-size: 2rem; color: #10B981;">check_circle</span>
          <p>Aucune alerte en cours</p>
        </div>
      }
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>Actions Rapides</h3>
    <div class="actions-grid">
      <a routerLink="/admin/clients" class="action-card">
        <span class="action-icon"><span class="material-icons">person_add</span></span>
        <span class="action-label">Nouveau Client</span>
      </a>
      <a routerLink="/admin/boutiques" class="action-card">
        <span class="action-icon"><span class="material-icons">description</span></span>
        <span class="action-label">Nouveau Contrat</span>
      </a>
      <a routerLink="/admin/loyers" class="action-card">
        <span class="action-icon"><span class="material-icons">receipt_long</span></span>
        <span class="action-label">Générer Facture</span>
      </a>
      <a routerLink="/admin/messages" class="action-card">
        <span class="action-icon"><span class="material-icons">chat</span></span>
        <span class="action-label">Envoyer Message</span>
      </a>
    </div>
  </div>
</div>
