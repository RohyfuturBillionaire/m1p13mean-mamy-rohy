<div class="profil-page">
  <div class="page-header">
    <div><h1>Ma Boutique</h1><p>Gérez les informations de votre boutique</p></div>
    <div class="header-actions">
      <button class="btn" [class.btn-outline]="!isEditing()" [class.btn-secondary]="isEditing()" (click)="toggleEdit()">
        <span class="material-icons">{{ isEditing() ? 'close' : 'edit' }}</span>
        {{ isEditing() ? 'Annuler' : 'Modifier' }}
      </button>
      @if (isEditing()) {
        <button class="btn btn-primary" (click)="saveChanges()">
          <span class="material-icons">save</span> Enregistrer
        </button>
      }
    </div>
  </div>

  @if (isLoading()) {
    <div class="loading">
      <span class="material-icons spinning">sync</span>
      <p>Chargement...</p>
    </div>
  } @else if (boutique()) {
    <div class="profil-content">
      <!-- Header Card -->
      <div class="header-card">
        <div class="boutique-cover">
          <img [src]="'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=1200'" alt="Cover">
        </div>
        <div class="boutique-header">
          <div class="boutique-logo">
            @if (boutique()!.logo) {
              <img [src]="getLogoUrl()" [alt]="boutique()!.nom">
            } @else {
              <span>{{ boutique()!.nom.charAt(0) }}</span>
            }
          </div>
          <div class="boutique-info">
            <h2>{{ boutique()!.nom }}</h2>
            <span class="boutique-type">
              @if (boutique()!.id_categorie) {
                {{ boutique()!.id_categorie!.icone }} {{ boutique()!.id_categorie!.nom }}
              }
              @if (boutique()!.local_boutique) {
                • Étage {{ boutique()!.local_boutique!.etage }}
              }
            </span>
          </div>
          <div class="boutique-status">
            <span class="status-indicator" [class.open]="boutique()!.status"></span>
            <span>{{ boutique()!.status ? 'Ouvert' : 'Fermé' }}</span>
            <button class="toggle-btn" (click)="toggleStatus()">
              <span class="material-icons">{{ boutique()!.status ? 'toggle_on' : 'toggle_off' }}</span>
            </button>
          </div>
        </div>
      </div>

      <div class="cards-grid">
        <!-- Informations -->
        <div class="card">
          <div class="card-header"><h3>Informations</h3></div>
          <div class="card-body">
            @if (isEditing()) {
              <div class="form-group">
                <label>Nom de la boutique</label>
                <input type="text" [value]="editData().nom" (input)="updateField('nom', $any($event.target).value)">
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea rows="3" [value]="editData().description" (input)="updateField('description', $any($event.target).value)"></textarea>
              </div>
              <div class="form-group">
                <label>Type de boutique</label>
                <input type="text" [value]="editData().type_boutique" (input)="updateField('type_boutique', $any($event.target).value)">
              </div>
            } @else {
              <p class="description">{{ boutique()!.description || 'Aucune description' }}</p>
              @if (boutique()!.type_boutique) {
                <div class="info-item">
                  <span class="material-icons">category</span>
                  <span>{{ boutique()!.type_boutique }}</span>
                </div>
              }
            }
          </div>
        </div>

        <!-- Contact -->
        <div class="card">
          <div class="card-header"><h3>Contact</h3></div>
          <div class="card-body">
            @if (isEditing()) {
              <div class="form-group">
                <label>Email</label>
                <input type="email" [value]="editData().email" (input)="updateField('email', $any($event.target).value)">
              </div>
              <div class="form-group">
                <label>Réseaux sociaux</label>
                <input type="text" [value]="editData().reseau" (input)="updateField('reseau', $any($event.target).value)">
              </div>
            } @else {
              <div class="info-item">
                <span class="material-icons">email</span>
                <span>{{ boutique()!.email || 'Non renseigné' }}</span>
              </div>
              <div class="info-item">
                <span class="material-icons">share</span>
                <span>{{ boutique()!.reseau || 'Non renseigné' }}</span>
              </div>
              @if (boutique()!.local_boutique) {
                <div class="info-item">
                  <span class="material-icons">location_on</span>
                  <span>Étage {{ boutique()!.local_boutique!.etage }}, Local {{ boutique()!.local_boutique!.numero }}</span>
                </div>
              }
            }
          </div>
        </div>

        <!-- Horaires -->
        <div class="card">
          <div class="card-header"><h3>Horaires d'ouverture</h3></div>
          <div class="card-body">
            @if (isEditing()) {
              <div class="form-group">
                <label>Horaires</label>
                <input type="text" [value]="editData().horaire_ouvert" (input)="updateField('horaire_ouvert', $any($event.target).value)" placeholder="Ex: 08:00 - 20:00">
              </div>
            } @else {
              <div class="info-item">
                <span class="material-icons">schedule</span>
                <span>{{ boutique()!.horaire_ouvert || 'Non renseigné' }}</span>
              </div>
            }
          </div>
        </div>

        <!-- Localisation -->
        <div class="card">
          <div class="card-header"><h3>Localisation</h3></div>
          <div class="card-body">
            @if (boutique()!.local_boutique) {
              <div class="stats-grid">
                <div class="stat">
                  <span class="stat-value">{{ boutique()!.local_boutique!.numero }}</span>
                  <span class="stat-label">Numéro local</span>
                </div>
                <div class="stat">
                  <span class="stat-value">{{ boutique()!.local_boutique!.etage }}</span>
                  <span class="stat-label">Étage</span>
                </div>
                <div class="stat">
                  <span class="stat-value">{{ boutique()!.local_boutique!.loyer | number }}</span>
                  <span class="stat-label">Ar/mois</span>
                </div>
              </div>
            } @else {
              <div class="info-item">
                <span class="material-icons">location_off</span>
                <span>Aucun local attribué</span>
              </div>
              @if (boutique()!.loyer) {
                <div class="info-item">
                  <span class="material-icons">payments</span>
                  <span>{{ boutique()!.loyer | number }} Ar/mois</span>
                </div>
              }
            }
          </div>
        </div>

        <!-- Catégorie -->
        <div class="card">
          <div class="card-header"><h3>Catégorie</h3></div>
          <div class="card-body">
            @if (boutique()!.id_categorie) {
              <div class="category-display">
                <span class="category-icon">{{ boutique()!.id_categorie!.icone }}</span>
                <div>
                  <strong>{{ boutique()!.id_categorie!.nom }}</strong>
                  <p>{{ boutique()!.id_categorie!.description }}</p>
                </div>
              </div>
            } @else {
              <div class="info-item">
                <span class="material-icons">category</span>
                <span>Non renseignée</span>
              </div>
            }
          </div>
        </div>

        <!-- Propriétaire -->
        <div class="card">
          <div class="card-header"><h3>Propriétaire</h3></div>
          <div class="card-body">
            @if (boutique()!.user_proprietaire) {
              <div class="info-item">
                <span class="material-icons">person</span>
                <span>{{ boutique()!.user_proprietaire!.email }}</span>
              </div>
            } @else {
              <div class="info-item">
                <span class="material-icons">person_off</span>
                <span>Non attribué</span>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="empty-state">
      <span class="material-icons">store</span>
      <h2>Aucune boutique</h2>
      <p>Vous n'avez pas encore de boutique associée à votre compte.</p>
    </div>
  }
</div>
