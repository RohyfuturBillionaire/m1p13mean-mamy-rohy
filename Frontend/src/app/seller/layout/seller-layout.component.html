<div class="seller-layout" [class.sidebar-collapsed]="sidebarCollapsed()" [class.sidebar-mobile-open]="sidebarMobileOpen()">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <a routerLink="/seller/dashboard" class="logo">
        <div class="logo-icon">
          <span class="material-icons">storefront</span>
        </div>
        <div class="logo-text">
          <span class="logo-title">Seller Panel</span>
          <span class="logo-subtitle">{{ boutique()?.nom || 'Ma Boutique' }}</span>
        </div>
      </a>
      <button class="collapse-btn desktop-toggle" (click)="toggleSidebar()" title="Replier/Déplier">
        <span class="material-icons">{{ sidebarCollapsed() ? 'chevron_right' : 'chevron_left' }}</span>
      </button>
    </div>

    <nav class="sidebar-nav">
      @for (item of menuItems; track item.route) {
        <a
          [routerLink]="item.route"
          routerLinkActive="active"
          class="nav-item"
          [attr.data-tooltip]="item.label"
          (click)="onNavClick()"
        >
          <span class="material-icons">{{ item.icon }}</span>
          <span class="nav-label">{{ item.label }}</span>
          @if (item.route === '/seller/stocks' && stockAlerts() > 0) {
            <span class="nav-badge alert">{{ stockAlerts() }}</span>
          }
          @if (item.route === '/seller/messages' && unreadMessages() > 0) {
            <span class="nav-badge">{{ unreadMessages() }}</span>
          }
        </a>
      }
    </nav>

    <div class="sidebar-footer">
      <a routerLink="/" class="nav-item" data-tooltip="Voir le site" (click)="onNavClick()">
        <span class="material-icons">language</span>
        <span class="nav-label">Voir le site</span>
      </a>
      <button class="logout-btn" (click)="logout()" data-tooltip="Déconnexion">
        <span class="material-icons">logout</span>
        <span class="nav-label">Déconnexion</span>
      </button>
    </div>
  </aside>

  <!-- Mobile Sidebar Backdrop -->
  @if (sidebarMobileOpen()) {
    <div class="sidebar-backdrop" (click)="closeMobileSidebar()"></div>
  }

  <!-- Main Content -->
  <div class="main-wrapper">
    <!-- Topbar -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" (click)="toggleMobileSidebar()" aria-label="Menu">
          <span class="material-icons">menu</span>
        </button>
        <div class="breadcrumb">
          <span class="breadcrumb-label">Espace Vendeur</span>
        </div>
      </div>

      <div class="topbar-right">
        <!-- Quick Stats -->
        <div class="quick-stats">
          @if (stockAlerts() > 0) {
            <a routerLink="/seller/stocks" class="stat-chip alert">
              <span class="material-icons">warning</span>
              <span>{{ stockAlerts() }} alertes stock</span>
            </a>
          }
        </div>

        <!-- Notifications -->
        <div class="notification-wrapper">
          <button class="icon-btn" (click)="toggleNotifications()" [class.active]="showNotifications()">
            <span class="material-icons">notifications</span>
            @if (unreadCount() > 0) {
              <span class="badge">{{ unreadCount() }}</span>
            }
          </button>

          @if (showNotifications()) {
            <div class="dropdown notification-dropdown">
              <div class="dropdown-header">
                <h3>Notifications</h3>
                @if (unreadCount() > 0) {
                  <button class="mark-all-btn" (click)="markAllAsRead()">Tout marquer lu</button>
                } @else {
                  <span class="unread-count">{{ unreadCount() }} non lues</span>
                }
              </div>
              <div class="dropdown-body">
                @if (notifications().length === 0) {
                  <div class="empty-notifications">
                    <span class="material-icons">notifications_none</span>
                    <p>Aucune notification</p>
                  </div>
                } @else {
                  @for (notif of unreadNotifications(); track notif._id) {
                    <div class="notification-item unread">
                      <button class="notif-body" (click)="navigateNotif(notif)">
                        <span
                          class="notif-icon material-icons"
                          [style.color]="getNotificationColor(notif.type)"
                        >
                          {{ getNotificationIcon(notif.type) }}
                        </span>
                        <div class="notif-content">
                          <span class="notif-title">{{ notif.titre }}</span>
                          <span class="notif-message">{{ notif.message }}</span>
                          <span class="notif-time">{{ formatDate(notif.createdAt) }}</span>
                        </div>
                      </button>
                      <button class="notif-read-btn" (click)="markAsRead(notif)" title="Marquer comme lu">
                        <span class="material-icons">check_circle</span>
                      </button>
                    </div>
                  }
                  @if (unreadNotifications().length === 0) {
                    <div class="empty-notifications">
                      <span class="material-icons">done_all</span>
                      <p>Tout est lu</p>
                    </div>
                  }
                }
              </div>
            </div>
          }
        </div>

        <!-- Boutique Menu -->
        <div class="user-wrapper">
          <button class="user-btn" (click)="toggleUserMenu()" [class.active]="showUserMenu()">
            <div class="user-avatar">
              @if (boutique()?.logo) {
                <img [src]="boutique()!.logo" [alt]="boutique()!.nom">
              } @else {
                <span>{{ getBoutiqueInitials() }}</span>
              }
            </div>
            <div class="user-info">
              <span class="user-name">{{ boutique()?.nom || 'Ma Boutique' }}</span>
              <span class="user-role">Vendeur</span>
            </div>
            <span class="material-icons arrow">{{ showUserMenu() ? 'expand_less' : 'expand_more' }}</span>
          </button>

          @if (showUserMenu()) {
            <div class="dropdown user-dropdown">
              <div class="dropdown-profile">
                <div class="profile-avatar">
                  @if (boutique()?.logo) {
                    <img [src]="boutique()!.logo" [alt]="boutique()!.nom">
                  } @else {
                    <span>{{ getBoutiqueInitials() }}</span>
                  }
                </div>
                <div class="profile-info">
                  <span class="profile-name">{{ boutique()?.nom }}</span>
                  <span class="profile-type">{{ boutique()?.type | titlecase }}</span>
                </div>
              </div>
              <!-- <div class="dropdown-divider"></div>
              <a routerLink="/seller/profil" class="dropdown-item" (click)="showUserMenu.set(false)">
                <span class="material-icons">storefront</span>
                Ma Boutique
              </a>
              <a routerLink="/seller/dashboard" class="dropdown-item" (click)="showUserMenu.set(false)">
                <span class="material-icons">bar_chart</span>
                Statistiques
              </a>
              <div class="dropdown-divider"></div> -->
              <button class="dropdown-item logout" (click)="logout()">
                <span class="material-icons">logout</span>
                Déconnexion
              </button>
            </div>
          }
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

<!-- Backdrop for dropdowns -->
@if (showNotifications() || showUserMenu()) {
  <div class="dropdown-backdrop" (click)="closeDropdowns()"></div>
}
