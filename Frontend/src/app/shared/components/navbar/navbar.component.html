<nav class="navbar" [class.scrolled]="isScrolled()">
  <div class="navbar-container">
    <!-- Logo -->
    <a routerLink="/" class="navbar-logo" (click)="closeMenus()">
      <div class="logo-icon">
        <span class="logo-t">T</span>
        <span class="logo-c">C</span>
      </div>
      <div class="logo-text">
        <span class="logo-name">Tana Center</span>
        <span class="logo-tagline">L'élégance au quotidien</span>
      </div>
    </a>

    <!-- Navigation Desktop -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
          Accueil
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/boutiques" routerLinkActive="active" class="nav-link">
          Nos Boutiques & Restaurants
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/map" routerLinkActive="active" class="nav-link">
          Plan du Centre
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/promotions" routerLinkActive="active" class="nav-link">
          Promotions
        </a>
      </li>
    </ul>

    <!-- Actions -->
    <div class="navbar-actions">
      <!-- Favorites -->
      <a routerLink="/mes-favoris" class="action-btn" aria-label="Mes favoris" (click)="closeMenus()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </a>

      <!-- Cart Button -->
      <button class="action-btn cart-toggle" (click)="openCart()" aria-label="Ouvrir le panier">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        @if (cartItemCount() > 0) {
          <span class="cart-badge">{{ cartItemCount() }}</span>
        }
      </button>

      <!-- User Menu -->
      <div class="user-wrapper">
        <button class="action-btn user-toggle" (click)="toggleUserMenu()" [attr.aria-expanded]="isUserMenuOpen()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </button>
        <div class="user-dropdown" [class.show]="isUserMenuOpen()">
          @if (isLoggedIn()) {
            @if (userName()) {
              <div class="user-dropdown-name">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                {{ userName() }}
              </div>
            }
          }
          @if (!isLoggedIn()) {
            <a routerLink="/connexion" class="user-dropdown-item" (click)="closeMenus()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
              </svg>
              Se connecter
            </a>
            <a routerLink="/inscription" class="user-dropdown-item" (click)="closeMenus()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              S'inscrire
            </a>
          }
          @if (isLoggedIn()) {
            <button class="user-dropdown-item logout-item" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Se déconnecter
            </button>
          }
        </div>
      </div>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [attr.aria-expanded]="isMobileMenuOpen()">
        <span class="hamburger" [class.active]="isMobileMenuOpen()">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" [class.open]="isMobileMenuOpen()">
    <div class="mobile-menu-content">
      <!-- Mobile Nav Links -->
      <ul class="mobile-nav">
        <li>
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" (click)="closeMenus()">
            Accueil
          </a>
        </li>
        <li>
          <a routerLink="/boutiques" routerLinkActive="active" (click)="closeMenus()">
            Nos Boutiques & Restaurants
          </a>
        </li>
        <li>
          <a routerLink="/map" routerLinkActive="active" (click)="closeMenus()">
            Plan du Centre
          </a>
        </li>
        <li>
          <a routerLink="/promotions" routerLinkActive="active" (click)="closeMenus()">
            Promotions
          </a>
        </li>
      </ul>

      <!-- Mobile Cart -->
      <button class="mobile-cart-btn" (click)="openCart()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        Mon Panier
        @if (cartItemCount() > 0) {
          <span class="cart-count">({{ cartItemCount() }})</span>
        }
      </button>

      <!-- Mobile Auth -->
      <div class="mobile-auth">
        @if (isLoggedIn() && userName()) {
          <span class="mobile-username">Bonjour, {{ userName() }}</span>
        }
        @if (!isLoggedIn()) {
          <a routerLink="/connexion" class="btn btn-secondary" (click)="closeMenus()">Se connecter</a>
          <a routerLink="/inscription" class="btn btn-primary" (click)="closeMenus()">S'inscrire</a>
        }
        @if (isLoggedIn()) {
          <button class="btn btn-outline" (click)="logout()">Se déconnecter</button>
        }
      </div>
    </div>
  </div>
</nav>

<!-- Overlay -->
<div class="navbar-overlay" [class.active]="isMobileMenuOpen() || isUserMenuOpen()" (click)="closeMenus()"></div>
